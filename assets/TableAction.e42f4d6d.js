var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,s=(e,t)=>{for(var n in t||(t={}))l.call(t,n)&&i(e,n,t[n]);if(o)for(var n of o(t))a.call(t,n)&&i(e,n,t[n]);return e},c=(e,o)=>t(e,n(o)),r=(e,t,n)=>new Promise(((o,l)=>{var a=e=>{try{s(n.next(e))}catch(t){l(t)}},i=e=>{try{s(n.throw(e))}catch(t){l(t)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(a,i);s((n=n.apply(e,t)).next())}));import{bf as u,bg as d,d as g,S as f,bh as p,bi as m,bj as h,f as b,j as y,k as v,bk as k,i as C,x as S,y as x,R as O,o as w,c as z,_ as P,b as _,be as L,bl as D,q as j,bm as A,g as F,bn as R,bo as U,bp as T,aO as V,p as $,a as E,t as I,V as q,$ as K,bq as B,br as M,r as Q,F as H,e as J,bs as G}from"./vendor.ea668100.js";import{d as N,u as W}from"./useDesignSetting.e6d12c1d.js";import{a as X,i as Y,b as Z,c as ee,d as te}from"./index.c53b1339.js";import{c as ne}from"./componentSetting.df76d574.js";const oe=Symbol("s-table");var le=g({name:"ColumnSetting",components:{SettingOutlined:f,DragOutlined:p,Draggable:N,VerticalRightOutlined:m,VerticalLeftOutlined:h},setup(){const{getDarkTheme:e}=W(),t=u(oe),n=b([]),o=b([]),l=y({selection:!1,checkAll:!0,checkList:[],defaultCheckList:[]}),a=v((()=>l.selection));function i(e){t.setColumns(e)}function r(){let e=[];return t.getColumns().forEach((t=>{e.push(s({},t))})),e}return k((()=>{t.getColumns().length&&function(){const e=r(),t=e.map((e=>e.key));l.checkList=t,l.defaultCheckList=t,n.value=e,o.value=e}()})),c(s({},C(l)),{columnsList:n,getDarkTheme:e,onChange:function(e){l.selection&&e.unshift("selection"),i(e)},onCheckAll:function(e){let n=t.getCacheColumns(!0);e?(i(n),l.checkList=n):(i([]),l.checkList=[])},onSelection:function(e){let n=t.getCacheColumns();e?(n.unshift({type:"selection",key:"selection"}),i(n)):(n.splice(0,1),i(n))},resetColumns:function(){l.checkList=[...l.defaultCheckList],l.checkAll=!0;let e=t.getCacheColumns().map((e=>c(s({},e),{fixed:void 0})));i(e),n.value=e},fixedColumn:function(e,o){if(!l.checkList.includes(e.key))return;let a=r();const s=e.fixed===o?void 0:o;let c=a.findIndex((t=>t.key===e.key));-1!==c&&(a[c].fixed=s),t.setCacheColumnsField(e.key,{fixed:s}),n.value[c].fixed=s,i(a)},draggableEnd:function(){const e=S(x(n));n.value=e,i(e)},getSelection:a})}});const ae={class:"cursor-pointer table-toolbar-right-icon"},ie={class:"table-toolbar-inner-popover-title"},se=L("列展示"),ce=L("勾选列"),re=L("重置"),ue={class:"table-toolbar-inner"},de={class:"drag-icon"},ge={class:"fixed-item"},fe=_("span",null,"固定到左侧",-1),pe=_("span",null,"固定到右侧",-1),me=_("span",null,"列设置",-1);function he(e){const t=b(x(e).columns);let n=x(e).columns;const o=v((()=>{const n=j(x(t));return function(e,t){const{actionColumn:n}=x(e);if(!n)return;t.push(s({},n))}(e,n),n||[]})),{hasPermission:l}=X();const a=v((()=>{const e=x(o);return j(e).filter((e=>l(e.auth)&&function(e){const t=e.ifShow;let n=!0;return ee(t)&&(n=t),te(t)&&(n=t(e)),n}(e)))}));return D((()=>x(e).columns),(e=>{t.value=e,n=e})),{getColumnsRef:o,getCacheColumns:function(e){return e?n.map((e=>e.key)):n},setCacheColumnsField:function(e,t){e&&t&&n.forEach((n=>{n.key!==e||Object.assign(n,t)}))},setColumns:function(e){const o=j(e);if(!Y(o))return;if(!o.length)return void(t.value=[]);const l=n.map((e=>e.key));if(Z(o[0])){const a=[];n.forEach((t=>{e.includes(t.key)&&a.push(s({},t))})),A(l,o)||a.sort(((e,t)=>l.indexOf(e.key)-l.indexOf(t.key))),t.value=a}else t.value=o},getColumns:function(){return S(x(o)).map((e=>c(s({},e),{title:e.title,key:e.key,fixed:e.fixed||void 0})))},getPageColumns:a}}le.render=function(e,t,n,o,l,a){const i=O("SettingOutlined"),s=O("n-icon"),c=O("n-checkbox"),r=O("n-button"),u=O("n-space"),d=O("DragOutlined"),g=O("VerticalRightOutlined"),f=O("n-tooltip"),p=O("n-divider"),m=O("VerticalLeftOutlined"),h=O("Draggable"),b=O("n-checkbox-group"),y=O("n-popover");return w(),z(f,{trigger:"hover"},{trigger:P((()=>[_("div",ae,[_(y,{trigger:"click",width:230,class:"toolbar-popover",placement:"bottom-end"},{trigger:P((()=>[_(s,{size:"18"},{default:P((()=>[_(i)])),_:1})])),header:P((()=>[_("div",ie,[_(u,null,{default:P((()=>[_(c,{checked:e.checkAll,"onUpdate:checked":[t[1]||(t[1]=t=>e.checkAll=t),e.onCheckAll]},{default:P((()=>[se])),_:1},8,["checked","onUpdate:checked"]),_(c,{checked:e.selection,"onUpdate:checked":[t[2]||(t[2]=t=>e.selection=t),e.onSelection]},{default:P((()=>[ce])),_:1},8,["checked","onUpdate:checked"]),_(r,{text:"",type:"info",size:"small",class:"mt-1",onClick:e.resetColumns},{default:P((()=>[re])),_:1},8,["onClick"])])),_:1})])])),default:P((()=>[_("div",ue,[_(b,{value:e.checkList,"onUpdate:value":[t[4]||(t[4]=t=>e.checkList=t),e.onChange]},{default:P((()=>[_(h,{modelValue:e.columnsList,"onUpdate:modelValue":t[3]||(t[3]=t=>e.columnsList=t),animation:"300","item-key":"key",onEnd:e.draggableEnd},{item:P((({element:t})=>[_("div",{class:["table-toolbar-inner-checkbox",{"table-toolbar-inner-checkbox-dark":!0===e.getDarkTheme}]},[_("span",de,[_(s,{size:"18"},{default:P((()=>[_(d)])),_:1})]),_(c,{value:t.key,label:t.title},null,8,["value","label"]),_("div",ge,[_(f,{trigger:"hover",placement:"bottom"},{trigger:P((()=>[_(s,{size:"18",color:"left"===t.fixed?"#2080f0":void 0,class:"cursor-pointer",onClick:n=>e.fixedColumn(t,"left")},{default:P((()=>[_(g)])),_:2},1032,["color","onClick"])])),default:P((()=>[fe])),_:2},1024),_(p,{vertical:""}),_(f,{trigger:"hover",placement:"bottom"},{trigger:P((()=>[_(s,{size:"18",color:"right"===t.fixed?"#2080f0":void 0,class:"cursor-pointer",onClick:n=>e.fixedColumn(t,"right")},{default:P((()=>[_(m)])),_:2},1032,["color","onClick"])])),default:P((()=>[pe])),_:2},1024)])],2)])),_:1},8,["modelValue","onEnd"])])),_:1},8,["value","onUpdate:value"])])])),_:1})])])),default:P((()=>[me])),_:1})};const{table:be}=ne,{apiSetting:ye,defaultPageSize:ve,pageSizes:ke}=be,Ce=ve,Se=ye,xe=ke;const Oe={title:{type:String,default:null},titleTooltip:{type:String,default:null},size:{type:String,default:"medium"},tableData:{type:[Object],default:()=>{}},columns:{type:[Array],default:()=>[],required:!0},request:{type:Function,default:null,required:!0},rowKey:{type:[String,Function],default:void 0},pagination:{type:[Object,Boolean],default:()=>{}},showPagination:{type:[String,Boolean],default:"auto"},actionColumn:{type:Object,default:null}},we=[{type:"menu",label:"紧凑",key:"small"},{type:"menu",label:"默认",key:"medium"},{type:"menu",label:"宽松",key:"large"}];var ze=g({components:{ReloadOutlined:R,ColumnHeightOutlined:U,ColumnSetting:le,QuestionCircleOutlined:T},props:s(s({},V.props),Oe),emits:["fetch-success","fetch-error","update:checked-row-keys"],setup(e,{emit:t}){const n=b(null),o=b([]),l=b(),a=v((()=>s(s({},e),x(l)))),{getLoading:i,setLoading:u}=function(e){const t=b(x(e).loading);return D((()=>x(e).loading),(e=>{t.value=e})),{getLoading:v((()=>x(t))),setLoading:function(e){t.value=e}}}(a),{getPaginationInfo:g,setPagination:f}=function(e){const t=b({}),n=b(!0),o=v((()=>{const{pagination:o}=x(e);return!(!x(n)||ee(o)&&!o)&&s(s({pageSize:Ce,pageSizes:xe,showSizePicker:!0,showQuickJumper:!0},ee(o)?{}:o),x(t))}));return{getPagination:function(){return x(o)},getPaginationInfo:o,setShowPagination:function(e){return r(this,null,(function*(){n.value=e}))},getShowPagination:function(){return x(n)},setPagination:function(e){const n=x(o);t.value=s(s({},ee(n)?{}:n),e)}}}(a),{getDataSourceRef:p,getRowKey:m,reload:h}=function(e,{getPaginationInfo:t,setPagination:n,setLoading:o,tableData:l},a){const i=b([]);k((()=>{l.value=x(i)})),D((()=>x(e).dataSource),(()=>{const{dataSource:t}=x(e);t&&(i.value=t)}),{immediate:!0});const c=v((()=>{const{rowKey:t}=x(e);return t||(()=>"key")})),u=v((()=>{const e=x(i);return e&&e.length,x(i)}));function d(l){return r(this,null,(function*(){try{o(!0);const{request:c,pagination:r}=x(e),u=Se.pageField,g=Se.sizeField,f=Se.totalField,p=Se.listField;let m={};const{page:h=1,pageSize:b=10}=x(t);ee(r)&&!r||ee(t)?m={}:(m[u]=l&&l[u]||h,m[g]=b);const y=s({},m),v=yield c(y),k=v[f]||0,C=v[u];if(k){const e=Math.ceil(k/b);h>e&&(n({[u]:e}),d(l))}const S=v[p]?v[p]:[];i.value=S,n({[u]:C,[f]:k}),l&&l[u]&&n({[u]:l[u]||1}),a("fetch-success",{items:x(S),resultTotal:k})}catch(c){a("fetch-error",c),i.value=[]}finally{o(!1)}}))}return F((()=>{setTimeout((()=>{d()}),16)})),{fetch:d,getRowKey:c,getDataSourceRef:u,getDataSource:function(){return u.value},setTableData:function(e){i.value=e},reload:function(e){return r(this,null,(function*(){yield d(e)}))}}}(a,{getPaginationInfo:g,setPagination:f,tableData:o,setLoading:u},t),{getPageColumns:O,setColumns:w,getColumns:z,getCacheColumns:P,setCacheColumnsField:_}=he(a),L=y({tableSize:"medium",isColumnSetting:!1});const j=v((()=>L.tableSize)),A=v((()=>{const e=x(p);return c(s({},x(a)),{loading:x(i),columns:S(x(O)),rowKey:x(m),data:e,size:x(j),remote:!0})})),R=v((()=>S(x(g))));const U={reload:h,setColumns:w,setLoading:u,setProps:function(e){l.value=s(s({},x(l)),e)},getColumns:z,getPageColumns:O,getCacheColumns:P,setCacheColumnsField:_,emit:t,getSize:()=>x(A).size};var T;return T=c(s({},U),{wrapRef:n,getBindValues:A}),d(oe,T),c(s({},C(L)),{getBindValues:A,densityOptions:we,reload:h,densitySelect:function(e){L.tableSize=e},updatePage:function(e){f({page:e}),h()},updatePageSize:function(e){f({page:1,pageSize:e}),h()},updateCheckedRowKeys:function(e){t("update:checked-row-keys",e)},pagination:R,resetColumns:()=>{columns.map((e=>{e.isShow=!0}))},tableAction:U})}});const Pe=J();$("data-v-337890f3");const _e={class:"table-toolbar"},Le={class:"flex items-center table-toolbar-left"},De={key:0,class:"table-toolbar-left-title"},je={class:"flex items-center table-toolbar-right"},Ae=_("span",null,"刷新",-1),Fe={class:"table-toolbar-right-icon"},Re=_("span",null,"密度",-1),Ue={class:"s-table"};E();const Te=Pe(((e,t,n,o,l,a)=>{const i=O("QuestionCircleOutlined"),s=O("n-icon"),c=O("n-tooltip"),r=O("ReloadOutlined"),u=O("ColumnHeightOutlined"),d=O("n-dropdown"),g=O("ColumnSetting"),f=O("n-data-table");return w(),z(H,null,[_("div",_e,[_("div",Le,[e.title?(w(),z("div",De,[L(I(e.title)+" ",1),e.titleTooltip?(w(),z(c,{key:0,trigger:"hover"},{trigger:Pe((()=>[_(s,{size:"18",class:"ml-1 cursor-pointer text-gray-400"},{default:Pe((()=>[_(i)])),_:1})])),default:Pe((()=>[L(" "+I(e.titleTooltip),1)])),_:1})):q("",!0)])):q("",!0),K(e.$slots,"tableTitle",{},void 0,!0)]),_("div",je,[K(e.$slots,"toolbar",{},void 0,!0),_(c,{trigger:"hover"},{trigger:Pe((()=>[_("div",{class:"table-toolbar-right-icon",onClick:t[1]||(t[1]=(...t)=>e.reload&&e.reload(...t))},[_(s,{size:"18"},{default:Pe((()=>[_(r)])),_:1})])])),default:Pe((()=>[Ae])),_:1}),_(c,{trigger:"hover"},{trigger:Pe((()=>[_("div",Fe,[_(d,{onSelect:e.densitySelect,trigger:"click",options:e.densityOptions,value:e.tableSize,"onUpdate:value":t[2]||(t[2]=t=>e.tableSize=t)},{default:Pe((()=>[_(s,{size:"18"},{default:Pe((()=>[_(u)])),_:1})])),_:1},8,["onSelect","options","value"])])])),default:Pe((()=>[Re])),_:1}),_(g)])]),_("div",Ue,[_(f,B(e.getBindValues,{pagination:e.pagination,"onUpdate:page":e.updatePage,"onUpdate:pageSize":e.updatePageSize}),M({_:2},[Q(Object.keys(e.$slots),(t=>({name:t,fn:Pe((n=>[K(e.$slots,t,n,void 0,!0)]))})))]),1040,["pagination","onUpdate:page","onUpdate:pageSize"])])],64)}));ze.render=Te,ze.__scopeId="data-v-337890f3";var Ve=g({name:"TableAction",components:{DownOutlined:G},props:{actions:{type:Array,default:null},dropDownActions:{type:Array,default:null},style:{type:String,default:"button"},select:{type:Function,default:()=>{}}},setup(e){const{hasPermission:t}=X(),n="button"===e.style?"default":"text"===e.style?"primary":"default",o="button"===e.style?void 0:"text"===e.style||void 0,l=v((()=>({text:o,type:n,size:"small"}))),a=v((()=>(S(e.dropDownActions)||[]).filter((e=>t(e.auth)&&i(e))).map((e=>{const{popConfirm:t}=e;return c(s(s({size:"small",text:o,type:n},e),t),{onConfirm:null==t?void 0:t.confirm,onCancel:null==t?void 0:t.cancel})}))));function i(e){const t=e.ifShow;let n=!0;return ee(t)&&(n=t),te(t)&&(n=t(e)),n}return{getActions:v((()=>(S(e.actions)||[]).filter((e=>t(e.auth)&&i(e))).map((e=>{const{popConfirm:t}=e;return c(s(s({size:"small",text:o,type:n},e),t||{}),{onConfirm:null==t?void 0:t.confirm,onCancel:null==t?void 0:t.cancel,enable:!!t})})))),getDropdownList:a,getMoreProps:l}}});const $e={class:"tableAction"},Ee={class:"flex items-center justify-center"},Ie={class:"flex items-center"},qe=_("span",null,"更多",-1);Ve.render=function(e,t,n,o,l,a){const i=O("n-button"),s=O("DownOutlined"),c=O("n-icon"),r=O("n-dropdown");return w(),z("div",$e,[_("div",Ee,[(w(!0),z(H,null,Q(e.getActions,((e,t)=>(w(),z(i,B({key:`${t}-${e.label}`},e,{class:"mx-2"}),{default:P((()=>[L(I(e.label),1)])),_:2},1040)))),128)),e.dropDownActions&&e.getDropdownList.length?(w(),z(r,{key:0,trigger:"hover",options:e.getDropdownList,onSelect:e.select},{default:P((()=>[K(e.$slots,"more"),e.$slots.more?q("",!0):(w(),z(i,B({key:0},e.getMoreProps,{class:"mx-2","icon-placement":"right"}),{default:P((()=>[_("div",Ie,[qe,_(c,{size:"14",class:"ml-1"},{default:P((()=>[_(s)])),_:1})])])),_:1},16))])),_:3},8,["options","onSelect"])):q("",!0)])])};export{ze as _,Ve as a};
