import{a6 as __unplugin_components_5,ah as useMessage,ai as useDialog,h as NIcon,F as __unplugin_components_9,r as __unplugin_components_4,a5 as __unplugin_components_5$1}from"./naive-ui-zccZ3jep.js";import{a as useGlobSetting,b as isString,R as ResultEnum,_ as _export_sfc}from"./index--2wEcaVU.js";import{c as componentSetting}from"./componentSetting-DYSsJNsh.js";import{q as PlusOutlined,f as DeleteOutlined,r as EyeOutlined}from"./vicons-antd-g9a0d-xa.js";import{k as defineComponent,c as computed,e as reactive,w as watch,Z as toRefs,a0 as resolveComponent,N as createElementBlock,O as openBlock,P as createBaseVNode,a2 as createVNode,a1 as createCommentVNode,F as Fragment,$ as renderList,L as normalizeStyle,a3 as withCtx,s as mergeProps,a4 as createBlock,j as createTextVNode,_ as toDisplayString}from"./vue-C3qUmXuJ.js";const basicProps={...__unplugin_components_5.props,accept:{type:String,default:".jpg,.png,.jpeg,.svg,.gif"},helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:1/0},value:{type:Array,default:()=>[]},width:{type:Number,default:104},height:{type:Number,default:104}},globSetting=useGlobSetting(),_sfc_main=defineComponent({name:"BasicUpload",components:{EyeOutlined,DeleteOutlined,PlusOutlined},props:{...basicProps},emits:["uploadChange","delete"],setup(props,{emit}){const getCSSProperties=computed(()=>({width:`${props.width}px`,height:`${props.height}px`})),message=useMessage(),dialog=useDialog(),state=reactive({showModal:!1,previewUrl:"",originalImgList:[],imgList:[]});watch(()=>props.value,()=>{state.imgList=props.value.map(e=>getImgUrl(e))},{immediate:!0});function preview(e){state.showModal=!0,state.previewUrl=e}function remove(e){dialog.info({title:"提示",content:"你确定要删除吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{state.imgList.splice(e,1),state.originalImgList.splice(e,1),emit("uploadChange",state.originalImgList),emit("delete",state.originalImgList)},onNegativeClick:()=>{}})}function getImgUrl(e){const{imgUrl:t}=globSetting;return/(^http|https:\/\/)/g.test(e)?e:`${t}${e}`}function checkFileType(e){return componentSetting.upload.fileType.includes(e)}function beforeUpload({file:e}){const t=e.file,{maxSize:o,accept:n}=props,a=isString(n)&&n.split(",")||[];if(o&&t.size/1024/1024>=o)return message.error(`上传文件最大值不能超过${o}M`),!1;const l=componentSetting.upload.fileType;return a.length>0&&!checkFileType(t.type)?(message.error(`只能上传文件类型为${l.join(",")}`),!1):!0}function finish({event:Event}){const res=eval("("+Event.target.response+")"),infoField=componentSetting.upload.apiSetting.infoField,{code}=res,message=res.msg||res.message||"上传失败",result=res[infoField];if(code===ResultEnum.SUCCESS){let e=getImgUrl(result.photo);state.imgList.push(e),state.originalImgList.push(result.photo),emit("uploadChange",state.originalImgList)}else message.error(message)}return{...toRefs(state),finish,preview,remove,beforeUpload,getCSSProperties}}}),_hoisted_1={class:"w-full"},_hoisted_2={class:"upload"},_hoisted_3={class:"upload-card"},_hoisted_4={class:"upload-card-item-info"},_hoisted_5={class:"img-box"},_hoisted_6=["src"],_hoisted_7={class:"img-box-actions"},_hoisted_8={class:"flex flex-col justify-center"},_hoisted_9=["src"];function _sfc_render(e,t,o,n,a,l){const c=resolveComponent("EyeOutlined"),i=NIcon,p=resolveComponent("DeleteOutlined"),d=resolveComponent("PlusOutlined"),u=__unplugin_components_5,m=__unplugin_components_9,_=__unplugin_components_4,g=__unplugin_components_5$1;return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.imgList,(s,r)=>(openBlock(),createElementBlock("div",{class:"upload-card-item",style:normalizeStyle(e.getCSSProperties),key:`img_${r}`},[createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[createBaseVNode("img",{src:s},null,8,_hoisted_6)]),createBaseVNode("div",_hoisted_7,[createVNode(i,{size:"18",class:"mx-2 action-icon",onClick:f=>e.preview(s)},{default:withCtx(()=>[createVNode(c)]),_:2},1032,["onClick"]),createVNode(i,{size:"18",class:"mx-2 action-icon",onClick:f=>e.remove(r)},{default:withCtx(()=>[createVNode(p)]),_:2},1032,["onClick"])])])],4))),128)),e.imgList.length<e.maxNumber?(openBlock(),createElementBlock("div",{key:0,class:"upload-card-item upload-card-item-select-picture",style:normalizeStyle(e.getCSSProperties)},[createVNode(u,mergeProps({class:"w-auto"},e.$props,{"file-list-style":{display:"none"},onBeforeUpload:e.beforeUpload,onFinish:e.finish}),{default:withCtx(()=>[createBaseVNode("div",_hoisted_8,[createVNode(i,{size:"18",class:"m-auto"},{default:withCtx(()=>[createVNode(d)]),_:1}),t[1]||(t[1]=createBaseVNode("span",{class:"upload-title"},"上传图片",-1))])]),_:1},16,["onBeforeUpload","onFinish"])],4)):createCommentVNode("",!0)])]),createVNode(_,null,{default:withCtx(()=>[e.helpText?(openBlock(),createBlock(m,{key:0,title:"提示",type:"info",class:"flex w-full"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.helpText),1)]),_:1})):createCommentVNode("",!0)]),_:1})]),createVNode(g,{show:e.showModal,"onUpdate:show":t[0]||(t[0]=s=>e.showModal=s),preset:"card",title:"预览",bordered:!1,style:{width:"520px"}},{default:withCtx(()=>[createBaseVNode("img",{src:e.previewUrl},null,8,_hoisted_9)]),_:1},8,["show"])],64)}const BasicUpload=_export_sfc(_sfc_main,[["render",_sfc_render]]);export{BasicUpload as B};
