var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,s=(e,t)=>{for(var n in t||(t={}))l.call(t,n)&&i(e,n,t[n]);if(o)for(var n of o(t))a.call(t,n)&&i(e,n,t[n]);return e},c=(e,o)=>t(e,n(o)),r=(e,t,n)=>new Promise(((o,l)=>{var a=e=>{try{s(n.next(e))}catch(t){l(t)}},i=e=>{try{s(n.throw(e))}catch(t){l(t)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(a,i);s((n=n.apply(e,t)).next())}));import{bg as u,bh as d,d as g,bi as f,bj as p,S as m,bk as h,bl as b,bm as y,f as v,j as k,k as C,bn as S,i as x,x as O,y as P,V as w,o as z,c as _,$ as D,b as L,bf as j,bo as A,q as R,bp as F,g as T,bq as U,aP as V,p as $,a as E,t as I,X as q,a0 as K,br as B,bs as H,r as M,F as Q,e as J,bt as X}from"./vendor.af0afcfa.js";import{d as G,u as N}from"./useDesignSetting.db6666bf.js";import{a as W,i as Y,b as Z,c as ee,d as te}from"./index.e1fec0d3.js";import{c as ne}from"./componentSetting.df76d574.js";const oe=Symbol("s-table");var le=g({name:"ColumnSetting",components:{ReloadOutlined:f,ColumnHeightOutlined:p,SettingOutlined:m,DragOutlined:h,Draggable:G,VerticalRightOutlined:b,VerticalLeftOutlined:y},setup(e,{emit:t}){const{getDarkTheme:n}=N(),o=u(oe),l=v([]),a=v([]),i=k({selection:!1,checkAll:!0,checkList:[],defaultCheckList:[]}),r=C((()=>i.selection));function d(e){o.setColumns(e)}function g(){let e=[];return o.getColumns().forEach((t=>{e.push(s({},t))})),e}return S((()=>{o.getColumns().length&&function(){const e=g(),t=e.map((e=>e.key));i.checkList=t,i.defaultCheckList=t,l.value=e,a.value=e}()})),c(s({},x(i)),{columnsList:l,getDarkTheme:n,onChange:function(e){i.selection&&e.unshift("selection"),d(e)},onCheckAll:function(e){let t=o.getCacheColumns(!0);e?(d(t),i.checkList=t):(d([]),i.checkList=[])},onSelection:function(e){let t=o.getCacheColumns();e?(t.unshift({type:"selection",key:"selection"}),d(t)):(t.splice(0,1),d(t))},resetColumns:function(){i.checkList=[...i.defaultCheckList],i.checkAll=!0;let e=o.getCacheColumns().map((e=>c(s({},e),{fixed:void 0})));d(e),l.value=e},fixedColumn:function(e,t){if(!i.checkList.includes(e.key))return;let n=g();const a=e.fixed===t?void 0:t;let s=n.findIndex((t=>t.key===e.key));-1!==s&&(n[s].fixed=a),o.setCacheColumnsField(e.key,{fixed:a}),l.value[s].fixed=a,d(n)},draggableEnd:function(){const e=O(P(l));l.value=e,d(e)},getSelection:r})}});const ae={class:"cursor-pointer table-toolbar-right-icon"},ie={class:"table-toolbar-inner-popover-title"},se=j("列展示"),ce=j("勾选列"),re=j("重置"),ue={class:"table-toolbar-inner"},de={class:"drag-icon"},ge={class:"fixed-item"},fe=L("span",null,"固定到左侧",-1),pe=L("span",null,"固定到右侧",-1),me=L("span",null,"列设置",-1);function he(e){const t=v(P(e).columns);let n=P(e).columns;const o=C((()=>{const n=R(P(t));return function(e,t){const{actionColumn:n}=P(e);if(!n)return;t.push(s({},n))}(e,n),n||[]})),{hasPermission:l}=W();const a=C((()=>{const e=P(o);return R(e).filter((e=>l(e.auth)&&function(e){const t=e.ifShow;let n=!0;return ee(t)&&(n=t),te(t)&&(n=t(e)),n}(e)))}));return A((()=>P(e).columns),(e=>{t.value=e,n=e})),{getColumnsRef:o,getCacheColumns:function(e){return e?n.map((e=>e.key)):n},setCacheColumnsField:function(e,t){e&&t&&n.forEach((n=>{n.key!==e||Object.assign(n,t)}))},setColumns:function(e){const o=R(e);if(!Y(o))return;if(!o.length)return void(t.value=[]);const l=n.map((e=>e.key));if(Z(o[0])){const a=[];n.forEach((t=>{e.includes(t.key)&&a.push(s({},t))})),F(l,o)||a.sort(((e,t)=>l.indexOf(e.key)-l.indexOf(t.key))),t.value=a}else t.value=o},getColumns:function(){return O(P(o)).map((e=>c(s({},e),{title:e.title,key:e.key,fixed:e.fixed||void 0})))},getPageColumns:a}}le.render=function(e,t,n,o,l,a){const i=w("SettingOutlined"),s=w("n-icon"),c=w("n-checkbox"),r=w("n-button"),u=w("n-space"),d=w("DragOutlined"),g=w("VerticalRightOutlined"),f=w("n-tooltip"),p=w("n-divider"),m=w("VerticalLeftOutlined"),h=w("Draggable"),b=w("n-checkbox-group"),y=w("n-popover");return z(),_(f,{trigger:"hover"},{trigger:D((()=>[L("div",ae,[L(y,{trigger:"click",width:230,class:"toolbar-popover",placement:"bottom-end"},{trigger:D((()=>[L(s,{size:"18"},{default:D((()=>[L(i)])),_:1})])),header:D((()=>[L("div",ie,[L(u,null,{default:D((()=>[L(c,{checked:e.checkAll,"onUpdate:checked":[t[1]||(t[1]=t=>e.checkAll=t),e.onCheckAll]},{default:D((()=>[se])),_:1},8,["checked","onUpdate:checked"]),L(c,{checked:e.selection,"onUpdate:checked":[t[2]||(t[2]=t=>e.selection=t),e.onSelection]},{default:D((()=>[ce])),_:1},8,["checked","onUpdate:checked"]),L(r,{text:"",type:"info",size:"small",class:"mt-1",onClick:e.resetColumns},{default:D((()=>[re])),_:1},8,["onClick"])])),_:1})])])),default:D((()=>[L("div",ue,[L(b,{value:e.checkList,"onUpdate:value":[t[4]||(t[4]=t=>e.checkList=t),e.onChange]},{default:D((()=>[L(h,{modelValue:e.columnsList,"onUpdate:modelValue":t[3]||(t[3]=t=>e.columnsList=t),animation:"300","item-key":"key",onEnd:e.draggableEnd},{item:D((({element:t,index:n})=>[L("div",{class:["table-toolbar-inner-checkbox",{"table-toolbar-inner-checkbox-dark":!0===e.getDarkTheme}]},[L("span",de,[L(s,{size:"18"},{default:D((()=>[L(d)])),_:1})]),L(c,{value:t.key,label:t.title},null,8,["value","label"]),L("div",ge,[L(f,{trigger:"hover",placement:"bottom"},{trigger:D((()=>[L(s,{size:"18",color:"left"===t.fixed?"#2080f0":void 0,class:"cursor-pointer",onClick:n=>e.fixedColumn(t,"left")},{default:D((()=>[L(g)])),_:2},1032,["color","onClick"])])),default:D((()=>[fe])),_:2},1024),L(p,{vertical:""}),L(f,{trigger:"hover",placement:"bottom"},{trigger:D((()=>[L(s,{size:"18",color:"right"===t.fixed?"#2080f0":void 0,class:"cursor-pointer",onClick:n=>e.fixedColumn(t,"right")},{default:D((()=>[L(m)])),_:2},1032,["color","onClick"])])),default:D((()=>[pe])),_:2},1024)])],2)])),_:1},8,["modelValue","onEnd"])])),_:1},8,["value","onUpdate:value"])])])),_:1})])])),default:D((()=>[me])),_:1})};const{table:be}=ne,{apiSetting:ye,defaultPageSize:ve,pageSizes:ke}=be,Ce=ve,Se=ye,xe=ke;const Oe={title:{type:String,default:null},titleTooltip:{type:String,default:null},size:{type:String,default:"medium"},tableData:{type:[Object],default:()=>{}},columns:{type:[Array],default:()=>[],required:!0},request:{type:Function,default:null,required:!0},rowKey:{type:[String,Function],default:void 0},pagination:{type:[Object,Boolean],default:()=>{}},showPagination:{type:[String,Boolean],default:"auto"},actionColumn:{type:Object,default:null}},Pe=[{type:"menu",label:"紧凑",key:"small"},{type:"menu",label:"默认",key:"medium"},{type:"menu",label:"宽松",key:"large"}];var we=g({components:{ReloadOutlined:f,ColumnHeightOutlined:p,SettingOutlined:m,DragOutlined:h,ColumnSetting:le,QuestionCircleOutlined:U},props:s(s({},V.props),Oe),emits:["fetch-success","fetch-error","update:checked-row-keys"],setup(e,{emit:t}){const n=v(null),o=v([]),l=v(),a=C((()=>s(s({},e),P(l)))),{getLoading:i,setLoading:u}=function(e){const t=v(P(e).loading);return A((()=>P(e).loading),(e=>{t.value=e})),{getLoading:C((()=>P(t))),setLoading:function(e){t.value=e}}}(a),{getPaginationInfo:g,getPagination:f,setPagination:p,setShowPagination:m,getShowPagination:h}=function(e){const t=v({}),n=v(!0),o=C((()=>{const{pagination:o}=P(e);return!(!P(n)||ee(o)&&!o)&&s(s({pageSize:Ce,pageSizes:xe,showSizePicker:!0,showQuickJumper:!0},ee(o)?{}:o),P(t))}));return{getPagination:function(){return P(o)},getPaginationInfo:o,setShowPagination:function(e){return r(this,null,(function*(){n.value=e}))},getShowPagination:function(){return P(n)},setPagination:function(e){const n=P(o);t.value=s(s({},ee(n)?{}:n),e)}}}(a),{getDataSourceRef:b,getRowKey:y,getDataSource:w,setDataSource:z,reload:_}=function(e,{getPaginationInfo:t,setPagination:n,setLoading:o,tableData:l},a){const i=v([]);S((()=>{l.value=P(i)})),A((()=>P(e).dataSource),(()=>{const{dataSource:t}=P(e);t&&(i.value=t)}),{immediate:!0});const c=C((()=>{const{rowKey:t}=P(e);return t||(()=>"key")})),u=C((()=>{const e=P(i);return e&&e.length,P(i)}));function d(l){return r(this,null,(function*(){try{o(!0);const{request:c,pagination:r}=P(e),u=Se.pageField,g=Se.sizeField,f=Se.totalField,p=Se.listField;let m={};const{page:h=1,pageSize:b=10}=P(t);ee(r)&&!r||ee(t)?m={}:(m[u]=l&&l[u]||h,m[g]=b);let y=s({},m);const v=yield c(y),k=v[f]||0,C=v[u];if(k){const e=Math.ceil(k/b);h>e&&(n({[u]:e}),d(l))}let S=v[p]?v[p]:[];i.value=S,n({[u]:C,[f]:k}),l&&l[u]&&n({[u]:l[u]||1}),a("fetch-success",{items:P(S),resultTotal:k})}catch(c){a("fetch-error",c),i.value=[]}finally{o(!1)}}))}return T((()=>{setTimeout((()=>{d()}),16)})),{fetch:d,getRowKey:c,getDataSourceRef:u,getDataSource:function(){return u.value},setTableData:function(e){i.value=e},reload:function(e){return r(this,null,(function*(){yield d(e)}))}}}(a,{getPaginationInfo:g,setPagination:p,tableData:o,setLoading:u},t),{getPageColumns:D,setColumns:L,getColumns:j,getCacheColumns:R,setCacheColumnsField:F,getColumnsRef:U}=he(a),V=k({tableSize:"medium",isColumnSetting:!1});const $=C((()=>V.tableSize)),E=C((()=>{const e=P(b);return c(s({},P(a)),{loading:P(i),columns:O(P(D)),rowKey:P(y),data:e,size:P($),remote:!0})})),I=C((()=>O(P(g))));const q={reload:_,setColumns:L,setLoading:u,setProps:function(e){l.value=s(s({},P(l)),e)},getColumns:j,getPageColumns:D,getCacheColumns:R,setCacheColumnsField:F,emit:t,getSize:()=>P(E).size};var K;return K=c(s({},q),{wrapRef:n,getBindValues:E}),d(oe,K),c(s({},x(V)),{getBindValues:E,densityOptions:Pe,reload:_,densitySelect:function(e){V.tableSize=e},updatePage:function(e){p({page:e}),_()},updatePageSize:function(e){p({page:1,pageSize:e}),_()},updateCheckedRowKeys:function(e){t("update:checked-row-keys",e)},pagination:I,resetColumns:()=>{columns.map((e=>{e.isShow=!0}))},tableAction:q})}});const ze=J();$("data-v-7d697bb8");const _e={class:"table-toolbar"},De={class:"flex items-center table-toolbar-left "},Le={key:0,class:"table-toolbar-left-title"},je={class:"flex items-center table-toolbar-right"},Ae=L("span",null,"刷新",-1),Re={class:"table-toolbar-right-icon"},Fe=L("span",null,"密度",-1),Te={class:"s-table"};E();const Ue=ze(((e,t,n,o,l,a)=>{const i=w("QuestionCircleOutlined"),s=w("n-icon"),c=w("n-tooltip"),r=w("ReloadOutlined"),u=w("ColumnHeightOutlined"),d=w("n-dropdown"),g=w("ColumnSetting"),f=w("n-data-table");return z(),_(Q,null,[L("div",_e,[L("div",De,[e.title?(z(),_("div",Le,[j(I(e.title)+" ",1),e.titleTooltip?(z(),_(c,{key:0,trigger:"hover"},{trigger:ze((()=>[L(s,{size:"18",class:"ml-1 cursor-pointer text-gray-400"},{default:ze((()=>[L(i)])),_:1})])),default:ze((()=>[j(" "+I(e.titleTooltip),1)])),_:1})):q("",!0)])):q("",!0),K(e.$slots,"tableTitle",{},void 0,!0)]),L("div",je,[K(e.$slots,"toolbar",{},void 0,!0),L(c,{trigger:"hover"},{trigger:ze((()=>[L("div",{class:"table-toolbar-right-icon",onClick:t[1]||(t[1]=(...t)=>e.reload&&e.reload(...t))},[L(s,{size:"18"},{default:ze((()=>[L(r)])),_:1})])])),default:ze((()=>[Ae])),_:1}),L(c,{trigger:"hover"},{trigger:ze((()=>[L("div",Re,[L(d,{onSelect:e.densitySelect,trigger:"click",options:e.densityOptions,value:e.tableSize,"onUpdate:value":t[2]||(t[2]=t=>e.tableSize=t)},{default:ze((()=>[L(s,{size:"18"},{default:ze((()=>[L(u)])),_:1})])),_:1},8,["onSelect","options","value"])])])),default:ze((()=>[Fe])),_:1}),L(g)])]),L("div",Te,[L(f,B(e.getBindValues,{pagination:e.pagination,"onUpdate:page":e.updatePage,"onUpdate:pageSize":e.updatePageSize}),H({_:2},[M(Object.keys(e.$slots),(t=>({name:t,fn:ze((n=>[K(e.$slots,t,n,void 0,!0)]))})))]),1040,["pagination","onUpdate:page","onUpdate:pageSize"])])],64)}));we.render=Ue,we.__scopeId="data-v-7d697bb8";var Ve=g({name:"TableAction",components:{DownOutlined:X},props:{actions:{type:Array,default:null},dropDownActions:{type:Array,default:null},style:{type:String,default:"button"},select:{type:Function,default:()=>{}}},setup(e,{emit:t}){const{hasPermission:n}=W(),o=C((()=>e=>Z(e)?{title:e,placement:"bottom"}:Object.assign({placement:"bottom"},e))),l="button"===e.style?"default":"text"===e.style?"primary":"default",a="button"===e.style?void 0:"text"===e.style||void 0,i=C((()=>({text:a,type:l,size:"small"}))),r=C((()=>(O(e.dropDownActions)||[]).filter((e=>n(e.auth)&&u(e))).map(((e,t)=>{const{label:n,popConfirm:o}=e;return c(s(s({size:"small",text:a,type:l},e),o),{onConfirm:null==o?void 0:o.confirm,onCancel:null==o?void 0:o.cancel})}))));function u(e){const t=e.ifShow;let n=!0;return ee(t)&&(n=t),te(t)&&(n=t(e)),n}return{getActions:C((()=>(O(e.actions)||[]).filter((e=>n(e.auth)&&u(e))).map((e=>{const{popConfirm:t}=e;return c(s(s({size:"small",text:a,type:l},e),t||{}),{onConfirm:null==t?void 0:t.confirm,onCancel:null==t?void 0:t.cancel,enable:!!t})})))),getDropdownList:r,getTooltip:o,getMoreProps:i}}});const $e={class:"tableAction"},Ee={class:"flex items-center justify-center"},Ie={class:"flex items-center"},qe=L("span",null,"更多",-1);Ve.render=function(e,t,n,o,l,a){const i=w("n-button"),s=w("DownOutlined"),c=w("n-icon"),r=w("n-dropdown");return z(),_("div",$e,[L("div",Ee,[(z(!0),_(Q,null,M(e.getActions,((e,t)=>(z(),_(i,B({key:`${t}-${e.label}`},e,{class:"mx-2"}),{default:D((()=>[j(I(e.label),1)])),_:2},1040)))),128)),e.dropDownActions&&e.getDropdownList.length?(z(),_(r,{key:0,trigger:"hover",options:e.getDropdownList,onSelect:e.select},{default:D((()=>[K(e.$slots,"more"),e.$slots.more?q("",!0):(z(),_(i,B({key:0},e.getMoreProps,{class:"mx-2","icon-placement":"right"}),{default:D((()=>[L("div",Ie,[qe,L(c,{size:"14",class:"ml-1"},{default:D((()=>[L(s)])),_:1})])])),_:1},16))])),_:3},8,["options","onSelect"])):q("",!0)])])};export{we as _,Ve as a};
