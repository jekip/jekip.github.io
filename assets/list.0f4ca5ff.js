var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,s=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&i(e,n,t[n]);if(a)for(var n of a(t))l.call(t,n)&&i(e,n,t[n]);return e},c=(e,a)=>t(e,n(a)),u=(e,t,n)=>new Promise(((a,o)=>{var l=e=>{try{s(n.next(e))}catch(t){o(t)}},i=e=>{try{s(n.throw(e))}catch(t){o(t)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,i);s((n=n.apply(e,t)).next())}));import{b8 as r,b9 as d,d as g,ba as f,bb as p,S as m,bc as h,bd as b,be as v,f as k,j as y,k as C,bf as S,i as O,x as P,y as z,V as x,o as w,c as _,$ as L,b as D,b7 as j,bg as F,q as R,bh as U,g as V,bi as T,aP as A,p as E,a as I,t as q,X as K,a0 as B,bj as $,bk as H,r as Q,F as J,e as M}from"./vendor.eec3232e.js";import{d as X,u as G}from"./useDesignSetting.3d09b1ed.js";import{i as N,a as W,b as Y,A as Z}from"./index.f01a9f79.js";const ee=Symbol("s-table");var te=g({name:"ColumnSetting",components:{ReloadOutlined:f,ColumnHeightOutlined:p,SettingOutlined:m,DragOutlined:h,Draggable:X,VerticalRightOutlined:b,VerticalLeftOutlined:v},setup(e,{emit:t}){const{getDarkTheme:n}=G(),a=r(ee),o=k([]),l=k([]),i=y({selection:!1,checkAll:!0,checkList:[],defaultCheckList:[]}),u=C((()=>i.selection));function d(e){a.setColumns(e)}function g(){let e=[];return a.getColumns().forEach((t=>{e.push(s({},t))})),e}return S((()=>{a.getColumns().length&&function(){const e=g(),t=e.map((e=>e.key));i.checkList=t,i.defaultCheckList=t,o.value=e,l.value=e}()})),c(s({},O(i)),{columnsList:o,getDarkTheme:n,onChange:function(e){i.selection&&e.unshift("selection"),d(e)},onCheckAll:function(e){let t=a.getCacheColumns(!0);e?(d(t),i.checkList=t):(d([]),i.checkList=[])},onSelection:function(e){let t=a.getCacheColumns();e?(t.unshift({type:"selection",key:"selection"}),d(t)):(t.splice(0,1),d(t))},resetColumns:function(){i.checkList=[...i.defaultCheckList],i.checkAll=!0;let e=a.getCacheColumns().map((e=>c(s({},e),{fixed:void 0})));d(e),o.value=e},fixedColumn:function(e,t){if(!i.checkList.includes(e.key))return;let n=g();const l=e.fixed===t?void 0:t;let s=n.findIndex((t=>t.key===e.key));-1!==s&&(n[s].fixed=l),a.setCacheColumnsField(e.key,{fixed:l}),o.value[s].fixed=l,d(n)},draggableEnd:function(){const e=P(z(o));o.value=e,d(e)},getSelection:u})}});const ne={class:"cursor-pointer table-toolbar-right-icon"},ae={class:"table-toolbar-inner-popover-title"},oe=j("列展示"),le=j("勾选列"),ie=j("重置"),se={class:"table-toolbar-inner"},ce={class:"drag-icon"},ue={class:"fixed-item"},re=D("span",null,"固定到左侧",-1),de=D("span",null,"固定到右侧",-1),ge=D("span",null,"列设置",-1);te.render=function(e,t,n,a,o,l){const i=x("SettingOutlined"),s=x("n-icon"),c=x("n-checkbox"),u=x("n-button"),r=x("n-space"),d=x("DragOutlined"),g=x("VerticalRightOutlined"),f=x("n-tooltip"),p=x("n-divider"),m=x("VerticalLeftOutlined"),h=x("Draggable"),b=x("n-checkbox-group"),v=x("n-popover");return w(),_(f,{trigger:"hover"},{trigger:L((()=>[D("div",ne,[D(v,{trigger:"click",width:230,class:"toolbar-popover",placement:"bottom-end"},{trigger:L((()=>[D(s,{size:"18"},{default:L((()=>[D(i)])),_:1})])),header:L((()=>[D("div",ae,[D(r,null,{default:L((()=>[D(c,{checked:e.checkAll,"onUpdate:checked":[t[1]||(t[1]=t=>e.checkAll=t),e.onCheckAll]},{default:L((()=>[oe])),_:1},8,["checked","onUpdate:checked"]),D(c,{checked:e.selection,"onUpdate:checked":[t[2]||(t[2]=t=>e.selection=t),e.onSelection]},{default:L((()=>[le])),_:1},8,["checked","onUpdate:checked"]),D(u,{text:"",type:"info",size:"small",class:"mt-1",onClick:e.resetColumns},{default:L((()=>[ie])),_:1},8,["onClick"])])),_:1})])])),default:L((()=>[D("div",se,[D(b,{value:e.checkList,"onUpdate:value":[t[4]||(t[4]=t=>e.checkList=t),e.onChange]},{default:L((()=>[D(h,{modelValue:e.columnsList,"onUpdate:modelValue":t[3]||(t[3]=t=>e.columnsList=t),animation:"300","item-key":"key",onEnd:e.draggableEnd},{item:L((({element:t,index:n})=>[D("div",{class:["table-toolbar-inner-checkbox",{"table-toolbar-inner-checkbox-dark":!0===e.getDarkTheme}]},[D("span",ce,[D(s,{size:"18"},{default:L((()=>[D(d)])),_:1})]),D(c,{value:t.key,label:t.title},null,8,["value","label"]),D("div",ue,[D(f,{trigger:"hover",placement:"bottom"},{trigger:L((()=>[D(s,{size:"18",color:"left"===t.fixed?"#2080f0":void 0,class:"cursor-pointer",onClick:n=>e.fixedColumn(t,"left")},{default:L((()=>[D(g)])),_:2},1032,["color","onClick"])])),default:L((()=>[re])),_:2},1024),D(p,{vertical:""}),D(f,{trigger:"hover",placement:"bottom"},{trigger:L((()=>[D(s,{size:"18",color:"right"===t.fixed?"#2080f0":void 0,class:"cursor-pointer",onClick:n=>e.fixedColumn(t,"right")},{default:L((()=>[D(m)])),_:2},1032,["color","onClick"])])),default:L((()=>[de])),_:2},1024)])],2)])),_:1},8,["modelValue","onEnd"])])),_:1},8,["value","onUpdate:value"])])])),_:1})])])),default:L((()=>[ge])),_:1})};const{table:fe}={table:{apiSetting:{pageField:"page",sizeField:"pageSize",listField:"list",totalField:"pageCount"},defaultPageSize:10,pageSizes:[10,20,30,40,50]}},{apiSetting:pe,defaultPageSize:me,pageSizes:he}=fe,be=me,ve=pe,ke=he;const ye={title:{type:String,default:null},titleTooltip:{type:String,default:null},size:{type:String,default:"medium"},tableData:{type:[Object],default:()=>{}},columns:{type:[Array],default:()=>[],required:!0},request:{type:Function,default:null,required:!0},rowKey:{type:[String,Function],default:void 0},pagination:{type:[Object,Boolean],default:()=>{}},showPagination:{type:[String,Boolean],default:"auto"}},Ce=[{type:"menu",label:"紧凑",key:"small"},{type:"menu",label:"默认",key:"medium"},{type:"menu",label:"宽松",key:"large"}];var Se=g({components:{ReloadOutlined:f,ColumnHeightOutlined:p,SettingOutlined:m,DragOutlined:h,ColumnSetting:te,QuestionCircleOutlined:T},props:s(s({},A.props),ye),emits:["fetch-success","fetch-error","update:checked-row-keys"],setup(e,{emit:t}){const n=k(null),a=k([]),o=k(),l=C((()=>s(s({},e),z(o)))),{getLoading:i,setLoading:r}=function(e){const t=k(z(e).loading);return F((()=>z(e).loading),(e=>{t.value=e})),{getLoading:C((()=>z(t))),setLoading:function(e){t.value=e}}}(l),{getPaginationInfo:g,getPagination:f,setPagination:p,setShowPagination:m,getShowPagination:h}=function(e){const t=k({}),n=k(!0),a=C((()=>{const{pagination:a}=z(e);return!(!z(n)||Y(a)&&!a)&&s(s({pageSize:be,pageSizes:ke,showSizePicker:!0,showQuickJumper:!0},Y(a)?{}:a),z(t))}));return{getPagination:function(){return z(a)},getPaginationInfo:a,setShowPagination:function(e){return u(this,null,(function*(){n.value=e}))},getShowPagination:function(){return z(n)},setPagination:function(e){const n=z(a);t.value=s(s({},Y(n)?{}:n),e)}}}(l),{getDataSourceRef:b,getRowKey:v,getDataSource:x,setDataSource:w,reload:_}=function(e,{getPaginationInfo:t,setPagination:n,setLoading:a,tableData:o},l){const i=k([]);S((()=>{o.value=z(i)})),F((()=>z(e).dataSource),(()=>{const{dataSource:t}=z(e);t&&(i.value=t)}),{immediate:!0});const c=C((()=>{const{rowKey:t}=z(e);return t||(()=>"key")})),r=C((()=>{const e=z(i);return e&&e.length,z(i)}));function d(o){return u(this,null,(function*(){try{a(!0);const{request:c,pagination:u}=z(e),r=ve.pageField,g=ve.sizeField,f=ve.totalField,p=ve.listField;let m={};const{page:h=1,pageSize:b=10}=z(t);Y(u)&&!u||Y(t)?m={}:(m[r]=o&&o[r]||h,m[g]=b);let v=s({},m);const k=yield c(v),y=k[f]||0,C=k[r];if(y){const e=Math.ceil(y/b);h>e&&(n({[r]:e}),d(o))}let S=k[p]?k[p]:[];i.value=S,n({[r]:C,[f]:y}),o&&o[r]&&n({[r]:o[r]||1}),l("fetch-success",{items:z(S),resultTotal:y})}catch(c){l("fetch-error",c),i.value=[]}finally{a(!1)}}))}return V((()=>{setTimeout((()=>{d()}),16)})),{fetch:d,getRowKey:c,getDataSourceRef:r,getDataSource:function(){return r.value},setTableData:function(e){i.value=e},reload:function(e){return u(this,null,(function*(){yield d(e)}))}}}(l,{getPaginationInfo:g,setPagination:p,tableData:a,setLoading:r},t),{getPageColumns:L,setColumns:D,getColumns:j,getCacheColumns:T,setCacheColumnsField:A,getColumnsRef:E}=function(e){const t=k(z(e).columns);let n=z(e).columns;const a=C((()=>R(z(t)))),o=C((()=>{const e=z(a);return R(e)}));return F((()=>z(e).columns),(e=>{t.value=e,n=e})),{getColumnsRef:a,getCacheColumns:function(e){return e?n.map((e=>e.key)):n},setCacheColumnsField:function(e,t){e&&t&&n.forEach((n=>{n.key!==e||Object.assign(n,t)}))},setColumns:function(e){const a=R(e);if(!N(a))return;if(!a.length)return void(t.value=[]);const o=n.map((e=>e.key));if(W(a[0])){const l=[];n.forEach((t=>{e.includes(t.key)&&l.push(s({},t))})),U(o,a)||l.sort(((e,t)=>o.indexOf(e.key)-o.indexOf(t.key))),t.value=l}else t.value=a},getColumns:function(){return P(z(a)).map((e=>c(s({},e),{title:e.title,key:e.key,fixed:e.fixed||void 0})))},getPageColumns:o}}(l),I=y({tableSize:"medium",isColumnSetting:!1});const q=C((()=>I.tableSize)),K=C((()=>{const e=z(b);return c(s({},z(l)),{loading:z(i),columns:P(z(L)),rowKey:z(v),data:e,size:z(q),remote:!0})})),B=C((()=>P(z(g))));const $={reload:_,setColumns:D,setLoading:r,setProps:function(e){o.value=s(s({},z(o)),e)},getColumns:j,getPageColumns:L,getCacheColumns:T,setCacheColumnsField:A,emit:t,getSize:()=>z(K).size};var H;return H=c(s({},$),{wrapRef:n,getBindValues:K}),d(ee,H),c(s({},O(I)),{getBindValues:K,densityOptions:Ce,reload:_,densitySelect:function(e){I.tableSize=e},updatePage:function(e){p({page:e}),_()},updatePageSize:function(e){p({page:1,pageSize:e}),_()},updateCheckedRowKeys:function(e){t("update:checked-row-keys",e)},pagination:B,resetColumns:()=>{columns.map((e=>{e.isShow=!0}))},tableAction:$})}});const Oe=M();E("data-v-15d759be");const Pe={class:"table-toolbar"},ze={class:"flex items-center table-toolbar-left "},xe={key:0,class:"table-toolbar-left-title"},we={class:"flex items-center table-toolbar-right"},_e=D("span",null,"刷新",-1),Le={class:"table-toolbar-right-icon"},De=D("span",null,"密度",-1),je={class:"s-table"};I();const Fe=Oe(((e,t,n,a,o,l)=>{const i=x("QuestionCircleOutlined"),s=x("n-icon"),c=x("n-tooltip"),u=x("ReloadOutlined"),r=x("ColumnHeightOutlined"),d=x("n-dropdown"),g=x("ColumnSetting"),f=x("n-data-table");return w(),_(J,null,[D("div",Pe,[D("div",ze,[e.title?(w(),_("div",xe,[j(q(e.title)+" ",1),e.titleTooltip?(w(),_(c,{key:0,trigger:"hover"},{trigger:Oe((()=>[D(s,{size:"18",class:"ml-1 cursor-pointer text-gray-400"},{default:Oe((()=>[D(i)])),_:1})])),default:Oe((()=>[j(" "+q(e.titleTooltip),1)])),_:1})):K("",!0)])):K("",!0),B(e.$slots,"tableTitle",{},void 0,!0)]),D("div",we,[B(e.$slots,"toolbar",{},void 0,!0),D(c,{trigger:"hover"},{trigger:Oe((()=>[D("div",{class:"table-toolbar-right-icon",onClick:t[1]||(t[1]=(...t)=>e.reload&&e.reload(...t))},[D(s,{size:"18"},{default:Oe((()=>[D(u)])),_:1})])])),default:Oe((()=>[_e])),_:1}),D(c,{trigger:"hover"},{trigger:Oe((()=>[D("div",Le,[D(d,{onSelect:e.densitySelect,trigger:"click",options:e.densityOptions,value:e.tableSize,"onUpdate:value":t[2]||(t[2]=t=>e.tableSize=t)},{default:Oe((()=>[D(s,{size:"18"},{default:Oe((()=>[D(r)])),_:1})])),_:1},8,["onSelect","options","value"])])])),default:Oe((()=>[De])),_:1}),D(g)])]),D("div",je,[D(f,$(e.getBindValues,{pagination:e.pagination,"onUpdate:page":e.updatePage,"onUpdate:pageSize":e.updatePageSize}),H({_:2},[Q(Object.keys(e.$slots),(t=>({name:t,fn:Oe((n=>[B(e.$slots,t,n,void 0,!0)]))})))]),1040,["pagination","onUpdate:page","onUpdate:pageSize"])])],64)}));function Re(e){return Z.request({url:"/table/list",method:"get",params:e})}Se.render=Fe,Se.__scopeId="data-v-15d759be";export{Se as _,Re as g};
