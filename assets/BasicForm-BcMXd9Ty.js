import{h as L,m as W,n as ne,k as H,b as oe,o as le,_ as se}from"./index--2wEcaVU.js";import{K as n,Y as K,k as ae,r as F,e as ue,c as S,w as re,o as ie,a0 as I,a4 as p,O as r,a3 as l,a2 as k,ac as fe,ad as ce,N as $,a1 as R,F as A,$ as G,s as U,ab as de,q,j as V,_ as N,a7 as pe,L as Y}from"./vue-C3qUmXuJ.js";import{s as me}from"./lodash-es-Wid6WkHk.js";import{p as T}from"./propTypes-BvihHqXo.js";import{Q as _e,K as ge,t as be}from"./vicons-antd-g9a0d-xa.js";import{L as ye,M as ve,e as ke,f as Be,r as Oe,g as Pe,V as we,W as Fe,s as Se,h as Ce,B as he,d as Ve}from"./naive-ui-zccZ3jep.js";function Ne(e){return e==="NInput"?"请输入":["NPicker","NSelect","NCheckbox","NRadio","NSwitch","NDatePicker","NTimePicker"].includes(e)?"请选择":""}function je({emit:e,getProps:O,formModel:b,getSchema:P,formElRef:m,defaultFormModel:_,loadingSub:i,handleFormValues:a}){async function o(){return n(m)?.validate()}async function y(s){s&&s.preventDefault(),i.value=!0;const{submitFunc:d}=n(O);if(d&&L(d))return await d(),i.value=!1,!1;if(!n(m))return!1;try{await o();const f=C();return i.value=!1,e("submit",f),f}catch(f){return e("submit",!1),i.value=!1,console.error(f),!1}}async function B(){await n(m)?.restoreValidation()}async function j(){const{resetFunc:s,submitOnReset:d}=n(O);if(s&&L(s)&&await s(),!n(m))return;Object.keys(b).forEach(h=>{b[h]=n(_)[h]||null}),await B();const f=a(K(n(b)));e("reset",f),d&&await y()}function C(){return n(m)?a(K(n(b))):{}}async function M(s){const d=n(P).map(g=>g.field).filter(Boolean);Object.keys(s).forEach(g=>{const f=s[g];d.includes(g)&&(b[g]=f)})}function v(s){i.value=s}return{handleSubmit:y,validate:o,resetFields:j,getFieldsValue:C,clearValidate:B,setFieldsValue:M,setLoading:v}}function Me({defaultFormModel:e,getSchema:O,formModel:b}){function P(_){if(!ne(_))return{};const i={};for(const a of Object.entries(_)){let[,o]=a;const[y]=a;!y||H(o)&&o.length===0||L(o)||W(o)||(oe(o)&&(o=o.trim()),me(i,y,o))}return i}function m(){const _=n(O),i={};_.forEach(a=>{const{defaultValue:o}=a;W(o)||(i[a.field]=o,b[a.field]=o)}),e.value=i}return{handleFormValues:P,initDefault:m}}const De={labelWidth:{type:[Number,String],default:80},schemas:{type:[Array],default:()=>[]},layout:{type:String,default:"inline"},inline:{type:Boolean,default:!1},size:{type:String,default:"medium"},labelPlacement:{type:String,default:"left"},isFull:{type:Boolean,default:!0},showActionButtonGroup:T.bool.def(!0),showResetButton:T.bool.def(!0),resetButtonOptions:Object,showSubmitButton:T.bool.def(!0),submitButtonOptions:Object,showAdvancedButton:T.bool.def(!0),submitButtonText:{type:String,default:"查询"},resetButtonText:{type:String,default:"重置"},gridProps:Object,giProps:Object,baseGridStyle:{type:Object},collapsed:{type:Boolean,default:!1},collapsedRows:{type:Number,default:1}},Re=ae({name:"BasicForm",components:{DownOutlined:be,UpOutlined:ge,QuestionCircleOutlined:_e},props:{...De},emits:["reset","submit","register"],setup(e,{emit:O,attrs:b}){const P=F({}),m=ue({}),_=F({}),i=F(null),a=F(null),o=F(!0),y=F(!1),B=F(!1),j=S(()=>Object.assign({size:e.size,type:"primary"},e.submitButtonOptions)),C=S(()=>Object.assign({size:e.size,type:"default"},e.resetButtonOptions));function M(u){const w=u.componentProps??{},D=u.component;return{clearable:!0,placeholder:Ne(n(D)),...w}}const v=S(()=>{const u={...e,...n(_)},w={rules:{}};return(u.schemas||[]).forEach(E=>{E.rules&&H(E.rules)&&(w.rules[E.field]=E.rules)}),{...u,...n(w)}}),s=S(()=>{const{layout:u}=n(v);return u==="inline"}),d=S(()=>{const{gridProps:u}=n(v);return{...u,collapsed:s.value?o.value:!1,responsive:"screen"}}),g=S(()=>({...b,...e,...n(v)})),f=S(()=>{const u=n(i)||n(v).schemas;for(const w of u){const{defaultValue:D}=w;D&&(w.defaultValue=D)}return u}),{handleFormValues:h,initDefault:z}=Me({defaultFormModel:P,getSchema:f,formModel:m}),{handleSubmit:t,validate:c,resetFields:Q,getFieldsValue:J,clearValidate:X,setFieldsValue:Z}=je({emit:O,getProps:v,formModel:m,getSchema:f,formElRef:a,defaultFormModel:P,loadingSub:y,handleFormValues:h});function x(){o.value=!o.value}async function ee(u){_.value=le(n(_)||{},u)}const te={getFieldsValue:J,setFieldsValue:Z,resetFields:Q,validate:c,clearValidate:X,setProps:ee,submit:t};return re(()=>f.value,u=>{n(B)||u?.length&&(z(),B.value=!0)}),ie(()=>{z(),O("register",te)}),{formElRef:a,formModel:m,getGrid:d,getProps:v,getBindValue:g,getSchema:f,getSubmitBtnOptions:j,getResetBtnOptions:C,handleSubmit:t,resetFields:Q,loadingSub:y,isInline:s,getComponentProps:M,unfoldToggle:x}}});function Ue(e,O,b,P,m,_){const i=I("QuestionCircleOutlined"),a=Ce,o=Se,y=Pe,B=Oe,j=Be,C=Fe,M=we,v=ke,s=ve,d=he,g=I("DownOutlined"),f=I("UpOutlined"),h=ye,z=Ve;return r(),p(z,U(e.getBindValue,{model:e.formModel,ref:"formElRef"}),{default:l(()=>[k(h,fe(ce(e.getGrid)),{default:l(()=>[(r(!0),$(A,null,G(e.getSchema,t=>(r(),p(s,U({ref_for:!0},t.giProps,{key:t.field}),{default:l(()=>[k(v,{label:t.label,path:t.field},de({default:l(()=>[t.slot?q(e.$slots,t.slot,{key:0,model:e.formModel,field:t.field,value:e.formModel[t.field]},void 0,!0):t.component==="NCheckbox"?(r(),p(j,{key:1,value:e.formModel[t.field],"onUpdate:value":c=>e.formModel[t.field]=c},{default:l(()=>[k(B,null,{default:l(()=>[(r(!0),$(A,null,G(t.componentProps.options,c=>(r(),p(y,{key:c.value,value:c.value,label:c.label},null,8,["value","label"]))),128))]),_:2},1024)]),_:2},1032,["value","onUpdate:value"])):t.component==="NRadioGroup"?(r(),p(M,{key:2,value:e.formModel[t.field],"onUpdate:value":c=>e.formModel[t.field]=c},{default:l(()=>[k(B,null,{default:l(()=>[(r(!0),$(A,null,G(t.componentProps.options,c=>(r(),p(C,{key:c.value,value:c.value},{default:l(()=>[V(N(c.label),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["value","onUpdate:value"])):(r(),p(pe(t.component),U({key:3,ref_for:!0},e.getComponentProps(t),{value:e.formModel[t.field],"onUpdate:value":c=>e.formModel[t.field]=c,class:{isFull:t.isFull!=!1&&e.getProps.isFull}}),null,16,["value","onUpdate:value","class"])),t.suffix?q(e.$slots,t.suffix,{key:4,model:e.formModel,field:t.field,value:e.formModel[t.field]},void 0,!0):R("",!0)]),_:2},[t.labelMessage?{name:"label",fn:l(()=>[V(N(t.label)+" ",1),k(o,{trigger:"hover",style:Y(t.labelMessageStyle)},{trigger:l(()=>[k(a,{size:"18",class:"text-gray-400 cursor-pointer"},{default:l(()=>[k(i)]),_:1})]),default:l(()=>[V(" "+N(t.labelMessage),1)]),_:2},1032,["style"])]),key:"0"}:void 0]),1032,["label","path"])]),_:2},1040))),128)),e.getProps.showActionButtonGroup?(r(),p(s,{key:0,span:e.isInline?"":24,suffix:!!e.isInline},{default:l(({overflow:t})=>[k(B,{align:"center",justify:e.isInline?"end":"start",style:Y({"margin-left":`${e.isInline?12:e.getProps.labelWidth}px`})},{default:l(()=>[e.getProps.showSubmitButton?(r(),p(d,U({key:0},e.getSubmitBtnOptions,{onClick:e.handleSubmit,loading:e.loadingSub,"attr-type":"submit"}),{default:l(()=>[V(N(e.getProps.submitButtonText),1)]),_:1},16,["onClick","loading"])):R("",!0),e.getProps.showResetButton?(r(),p(d,U({key:1},e.getResetBtnOptions,{onClick:e.resetFields}),{default:l(()=>[V(N(e.getProps.resetButtonText),1)]),_:1},16,["onClick"])):R("",!0),e.isInline&&e.getProps.showAdvancedButton?(r(),p(d,{key:2,type:"primary",text:"","icon-placement":"right",onClick:e.unfoldToggle},{icon:l(()=>[t?(r(),p(a,{key:0,size:"14",class:"unfold-icon"},{default:l(()=>[k(g)]),_:1})):(r(),p(a,{key:1,size:"14",class:"unfold-icon"},{default:l(()=>[k(f)]),_:1}))]),default:l(()=>[V(" "+N(t?"展开":"收起"),1)]),_:2},1032,["onClick"])):R("",!0)]),_:2},1032,["justify","style"])]),_:1},8,["span","suffix"])):R("",!0)]),_:3},16)]),_:3},16,["model"])}const Ge=se(Re,[["render",Ue],["__scopeId","data-v-c36fe6fa"]]);export{Ge as _};
