var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,s=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&i(e,n,t[n]);if(a)for(var n of a(t))l.call(t,n)&&i(e,n,t[n]);return e},c=(e,a)=>t(e,n(a)),u=(e,t,n)=>new Promise(((a,o)=>{var l=e=>{try{s(n.next(e))}catch(t){o(t)}},i=e=>{try{s(n.throw(e))}catch(t){o(t)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,i);s((n=n.apply(e,t)).next())}));import{b9 as r,ba as d,d as g,bb as f,bc as p,S as m,bd as h,be as b,bf as v,f as k,j as y,k as C,bg as S,i as O,x as P,y as x,R as z,o as _,c as w,_ as L,b as D,b8 as j,bh as R,q as U,bi as F,g as V,bj as T,aO as A,p as E,a as I,t as q,V as K,$ as B,bk as $,bl as H,r as Q,F as J,e as M}from"./vendor.735a8723.js";import{d as G,u as N}from"./useDesignSetting.739a8556.js";import{i as W,a as X,b as Y,A as Z}from"./index.2832a2ed.js";import{c as ee}from"./componentSetting.df76d574.js";const te=Symbol("s-table");var ne=g({name:"ColumnSetting",components:{ReloadOutlined:f,ColumnHeightOutlined:p,SettingOutlined:m,DragOutlined:h,Draggable:G,VerticalRightOutlined:b,VerticalLeftOutlined:v},setup(e,{emit:t}){const{getDarkTheme:n}=N(),a=r(te),o=k([]),l=k([]),i=y({selection:!1,checkAll:!0,checkList:[],defaultCheckList:[]}),u=C((()=>i.selection));function d(e){a.setColumns(e)}function g(){let e=[];return a.getColumns().forEach((t=>{e.push(s({},t))})),e}return S((()=>{a.getColumns().length&&function(){const e=g(),t=e.map((e=>e.key));i.checkList=t,i.defaultCheckList=t,o.value=e,l.value=e}()})),c(s({},O(i)),{columnsList:o,getDarkTheme:n,onChange:function(e){i.selection&&e.unshift("selection"),d(e)},onCheckAll:function(e){let t=a.getCacheColumns(!0);e?(d(t),i.checkList=t):(d([]),i.checkList=[])},onSelection:function(e){let t=a.getCacheColumns();e?(t.unshift({type:"selection",key:"selection"}),d(t)):(t.splice(0,1),d(t))},resetColumns:function(){i.checkList=[...i.defaultCheckList],i.checkAll=!0;let e=a.getCacheColumns().map((e=>c(s({},e),{fixed:void 0})));d(e),o.value=e},fixedColumn:function(e,t){if(!i.checkList.includes(e.key))return;let n=g();const l=e.fixed===t?void 0:t;let s=n.findIndex((t=>t.key===e.key));-1!==s&&(n[s].fixed=l),a.setCacheColumnsField(e.key,{fixed:l}),o.value[s].fixed=l,d(n)},draggableEnd:function(){const e=P(x(o));o.value=e,d(e)},getSelection:u})}});const ae={class:"cursor-pointer table-toolbar-right-icon"},oe={class:"table-toolbar-inner-popover-title"},le=j("列展示"),ie=j("勾选列"),se=j("重置"),ce={class:"table-toolbar-inner"},ue={class:"drag-icon"},re={class:"fixed-item"},de=D("span",null,"固定到左侧",-1),ge=D("span",null,"固定到右侧",-1),fe=D("span",null,"列设置",-1);ne.render=function(e,t,n,a,o,l){const i=z("SettingOutlined"),s=z("n-icon"),c=z("n-checkbox"),u=z("n-button"),r=z("n-space"),d=z("DragOutlined"),g=z("VerticalRightOutlined"),f=z("n-tooltip"),p=z("n-divider"),m=z("VerticalLeftOutlined"),h=z("Draggable"),b=z("n-checkbox-group"),v=z("n-popover");return _(),w(f,{trigger:"hover"},{trigger:L((()=>[D("div",ae,[D(v,{trigger:"click",width:230,class:"toolbar-popover",placement:"bottom-end"},{trigger:L((()=>[D(s,{size:"18"},{default:L((()=>[D(i)])),_:1})])),header:L((()=>[D("div",oe,[D(r,null,{default:L((()=>[D(c,{checked:e.checkAll,"onUpdate:checked":[t[1]||(t[1]=t=>e.checkAll=t),e.onCheckAll]},{default:L((()=>[le])),_:1},8,["checked","onUpdate:checked"]),D(c,{checked:e.selection,"onUpdate:checked":[t[2]||(t[2]=t=>e.selection=t),e.onSelection]},{default:L((()=>[ie])),_:1},8,["checked","onUpdate:checked"]),D(u,{text:"",type:"info",size:"small",class:"mt-1",onClick:e.resetColumns},{default:L((()=>[se])),_:1},8,["onClick"])])),_:1})])])),default:L((()=>[D("div",ce,[D(b,{value:e.checkList,"onUpdate:value":[t[4]||(t[4]=t=>e.checkList=t),e.onChange]},{default:L((()=>[D(h,{modelValue:e.columnsList,"onUpdate:modelValue":t[3]||(t[3]=t=>e.columnsList=t),animation:"300","item-key":"key",onEnd:e.draggableEnd},{item:L((({element:t,index:n})=>[D("div",{class:["table-toolbar-inner-checkbox",{"table-toolbar-inner-checkbox-dark":!0===e.getDarkTheme}]},[D("span",ue,[D(s,{size:"18"},{default:L((()=>[D(d)])),_:1})]),D(c,{value:t.key,label:t.title},null,8,["value","label"]),D("div",re,[D(f,{trigger:"hover",placement:"bottom"},{trigger:L((()=>[D(s,{size:"18",color:"left"===t.fixed?"#2080f0":void 0,class:"cursor-pointer",onClick:n=>e.fixedColumn(t,"left")},{default:L((()=>[D(g)])),_:2},1032,["color","onClick"])])),default:L((()=>[de])),_:2},1024),D(p,{vertical:""}),D(f,{trigger:"hover",placement:"bottom"},{trigger:L((()=>[D(s,{size:"18",color:"right"===t.fixed?"#2080f0":void 0,class:"cursor-pointer",onClick:n=>e.fixedColumn(t,"right")},{default:L((()=>[D(m)])),_:2},1032,["color","onClick"])])),default:L((()=>[ge])),_:2},1024)])],2)])),_:1},8,["modelValue","onEnd"])])),_:1},8,["value","onUpdate:value"])])])),_:1})])])),default:L((()=>[fe])),_:1})};const{table:pe}=ee,{apiSetting:me,defaultPageSize:he,pageSizes:be}=pe,ve=he,ke=me,ye=be;const Ce={title:{type:String,default:null},titleTooltip:{type:String,default:null},size:{type:String,default:"medium"},tableData:{type:[Object],default:()=>{}},columns:{type:[Array],default:()=>[],required:!0},request:{type:Function,default:null,required:!0},rowKey:{type:[String,Function],default:void 0},pagination:{type:[Object,Boolean],default:()=>{}},showPagination:{type:[String,Boolean],default:"auto"}},Se=[{type:"menu",label:"紧凑",key:"small"},{type:"menu",label:"默认",key:"medium"},{type:"menu",label:"宽松",key:"large"}];var Oe=g({components:{ReloadOutlined:f,ColumnHeightOutlined:p,SettingOutlined:m,DragOutlined:h,ColumnSetting:ne,QuestionCircleOutlined:T},props:s(s({},A.props),Ce),emits:["fetch-success","fetch-error","update:checked-row-keys"],setup(e,{emit:t}){const n=k(null),a=k([]),o=k(),l=C((()=>s(s({},e),x(o)))),{getLoading:i,setLoading:r}=function(e){const t=k(x(e).loading);return R((()=>x(e).loading),(e=>{t.value=e})),{getLoading:C((()=>x(t))),setLoading:function(e){t.value=e}}}(l),{getPaginationInfo:g,getPagination:f,setPagination:p,setShowPagination:m,getShowPagination:h}=function(e){const t=k({}),n=k(!0),a=C((()=>{const{pagination:a}=x(e);return!(!x(n)||Y(a)&&!a)&&s(s({pageSize:ve,pageSizes:ye,showSizePicker:!0,showQuickJumper:!0},Y(a)?{}:a),x(t))}));return{getPagination:function(){return x(a)},getPaginationInfo:a,setShowPagination:function(e){return u(this,null,(function*(){n.value=e}))},getShowPagination:function(){return x(n)},setPagination:function(e){const n=x(a);t.value=s(s({},Y(n)?{}:n),e)}}}(l),{getDataSourceRef:b,getRowKey:v,getDataSource:z,setDataSource:_,reload:w}=function(e,{getPaginationInfo:t,setPagination:n,setLoading:a,tableData:o},l){const i=k([]);S((()=>{o.value=x(i)})),R((()=>x(e).dataSource),(()=>{const{dataSource:t}=x(e);t&&(i.value=t)}),{immediate:!0});const c=C((()=>{const{rowKey:t}=x(e);return t||(()=>"key")})),r=C((()=>{const e=x(i);return e&&e.length,x(i)}));function d(o){return u(this,null,(function*(){try{a(!0);const{request:c,pagination:u}=x(e),r=ke.pageField,g=ke.sizeField,f=ke.totalField,p=ke.listField;let m={};const{page:h=1,pageSize:b=10}=x(t);Y(u)&&!u||Y(t)?m={}:(m[r]=o&&o[r]||h,m[g]=b);let v=s({},m);const k=yield c(v),y=k[f]||0,C=k[r];if(y){const e=Math.ceil(y/b);h>e&&(n({[r]:e}),d(o))}let S=k[p]?k[p]:[];i.value=S,n({[r]:C,[f]:y}),o&&o[r]&&n({[r]:o[r]||1}),l("fetch-success",{items:x(S),resultTotal:y})}catch(c){l("fetch-error",c),i.value=[]}finally{a(!1)}}))}return V((()=>{setTimeout((()=>{d()}),16)})),{fetch:d,getRowKey:c,getDataSourceRef:r,getDataSource:function(){return r.value},setTableData:function(e){i.value=e},reload:function(e){return u(this,null,(function*(){yield d(e)}))}}}(l,{getPaginationInfo:g,setPagination:p,tableData:a,setLoading:r},t),{getPageColumns:L,setColumns:D,getColumns:j,getCacheColumns:T,setCacheColumnsField:A,getColumnsRef:E}=function(e){const t=k(x(e).columns);let n=x(e).columns;const a=C((()=>U(x(t)))),o=C((()=>{const e=x(a);return U(e)}));return R((()=>x(e).columns),(e=>{t.value=e,n=e})),{getColumnsRef:a,getCacheColumns:function(e){return e?n.map((e=>e.key)):n},setCacheColumnsField:function(e,t){e&&t&&n.forEach((n=>{n.key!==e||Object.assign(n,t)}))},setColumns:function(e){const a=U(e);if(!W(a))return;if(!a.length)return void(t.value=[]);const o=n.map((e=>e.key));if(X(a[0])){const l=[];n.forEach((t=>{e.includes(t.key)&&l.push(s({},t))})),F(o,a)||l.sort(((e,t)=>o.indexOf(e.key)-o.indexOf(t.key))),t.value=l}else t.value=a},getColumns:function(){return P(x(a)).map((e=>c(s({},e),{title:e.title,key:e.key,fixed:e.fixed||void 0})))},getPageColumns:o}}(l),I=y({tableSize:"medium",isColumnSetting:!1});const q=C((()=>I.tableSize)),K=C((()=>{const e=x(b);return c(s({},x(l)),{loading:x(i),columns:P(x(L)),rowKey:x(v),data:e,size:x(q),remote:!0})})),B=C((()=>P(x(g))));const $={reload:w,setColumns:D,setLoading:r,setProps:function(e){o.value=s(s({},x(o)),e)},getColumns:j,getPageColumns:L,getCacheColumns:T,setCacheColumnsField:A,emit:t,getSize:()=>x(K).size};var H;return H=c(s({},$),{wrapRef:n,getBindValues:K}),d(te,H),c(s({},O(I)),{getBindValues:K,densityOptions:Se,reload:w,densitySelect:function(e){I.tableSize=e},updatePage:function(e){p({page:e}),w()},updatePageSize:function(e){p({page:1,pageSize:e}),w()},updateCheckedRowKeys:function(e){t("update:checked-row-keys",e)},pagination:B,resetColumns:()=>{columns.map((e=>{e.isShow=!0}))},tableAction:$})}});const Pe=M();E("data-v-7d697bb8");const xe={class:"table-toolbar"},ze={class:"flex items-center table-toolbar-left "},_e={key:0,class:"table-toolbar-left-title"},we={class:"flex items-center table-toolbar-right"},Le=D("span",null,"刷新",-1),De={class:"table-toolbar-right-icon"},je=D("span",null,"密度",-1),Re={class:"s-table"};I();const Ue=Pe(((e,t,n,a,o,l)=>{const i=z("QuestionCircleOutlined"),s=z("n-icon"),c=z("n-tooltip"),u=z("ReloadOutlined"),r=z("ColumnHeightOutlined"),d=z("n-dropdown"),g=z("ColumnSetting"),f=z("n-data-table");return _(),w(J,null,[D("div",xe,[D("div",ze,[e.title?(_(),w("div",_e,[j(q(e.title)+" ",1),e.titleTooltip?(_(),w(c,{key:0,trigger:"hover"},{trigger:Pe((()=>[D(s,{size:"18",class:"ml-1 cursor-pointer text-gray-400"},{default:Pe((()=>[D(i)])),_:1})])),default:Pe((()=>[j(" "+q(e.titleTooltip),1)])),_:1})):K("",!0)])):K("",!0),B(e.$slots,"tableTitle",{},void 0,!0)]),D("div",we,[B(e.$slots,"toolbar",{},void 0,!0),D(c,{trigger:"hover"},{trigger:Pe((()=>[D("div",{class:"table-toolbar-right-icon",onClick:t[1]||(t[1]=(...t)=>e.reload&&e.reload(...t))},[D(s,{size:"18"},{default:Pe((()=>[D(u)])),_:1})])])),default:Pe((()=>[Le])),_:1}),D(c,{trigger:"hover"},{trigger:Pe((()=>[D("div",De,[D(d,{onSelect:e.densitySelect,trigger:"click",options:e.densityOptions,value:e.tableSize,"onUpdate:value":t[2]||(t[2]=t=>e.tableSize=t)},{default:Pe((()=>[D(s,{size:"18"},{default:Pe((()=>[D(r)])),_:1})])),_:1},8,["onSelect","options","value"])])])),default:Pe((()=>[je])),_:1}),D(g)])]),D("div",Re,[D(f,$(e.getBindValues,{pagination:e.pagination,"onUpdate:page":e.updatePage,"onUpdate:pageSize":e.updatePageSize}),H({_:2},[Q(Object.keys(e.$slots),(t=>({name:t,fn:Pe((n=>[B(e.$slots,t,n,void 0,!0)]))})))]),1040,["pagination","onUpdate:page","onUpdate:pageSize"])])],64)}));function Fe(e){return Z.request({url:"/table/list",method:"get",params:e})}Oe.render=Ue,Oe.__scopeId="data-v-7d697bb8";export{Oe as _,Fe as g};
